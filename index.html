<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –§–ª–µ—à–∫–∞—Ä—Ç–æ–∫</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
    .container { max-width: 600px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 24px; }
    h1 { text-align: center; }
    nav { text-align: center; margin-bottom: 20px; }
    nav button { padding: 8px 16px; font-size: 1rem; margin: 0 4px; cursor: pointer; }
    nav button:hover { background: #0077ff; color: #fff; }
    form { display: flex; gap: 8px; margin-bottom: 24px; }
    input, button { padding: 8px; font-size: 1rem; }
    input { flex: 1; border: 1px solid #ccc; border-radius: 4px; }
    button { background: #0077ff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #005fcc; }
    .flashcard { background: #f0f4ff; margin-bottom: 12px; padding: 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
    .flashcard .qa { flex: 1; }
    .flashcard-actions { display: flex; gap: 8px; }
    .flashcard input { width: 100%; margin-bottom: 4px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –§–ª–µ—à–∫–∞—Ä—Ç–æ–∫</h1>
    <nav>
      <button onclick="showPage('list')">–í—Å—ñ –∫–∞—Ä—Ç–∫–∏</button>
      <button onclick="showPage('add')">–î–æ–¥–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É</button>
    </nav>
    <div id="page-list" style="display:none;">
      <h2>–í—Å—ñ –∫–∞—Ä—Ç–∫–∏</h2>
      <div id="flashcards"></div>
    </div>
    <div id="page-add" style="display:none;">
      <h2>–î–æ–¥–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É</h2>
      <form id="addForm">
        <input type="text" id="question" placeholder="–ü–∏—Ç–∞–Ω–Ω—è" required />
        <input type="text" id="answer" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å" required />
        <button type="submit">–î–æ–¥–∞—Ç–∏</button>
      </form>
    </div>
    <div id="page-edit" style="display:none;"></div>
  </div>
  <script>
    const api = "/.netlify/functions/flashcards";
    let editingId = null;

    function showPage(page) {
      document.getElementById('page-list').style.display = page === 'list' ? '' : 'none';
      document.getElementById('page-add').style.display = page === 'add' ? '' : 'none';
      document.getElementById('page-edit').style.display = page === 'edit' ? '' : 'none';
      if (page === 'list') fetchFlashcards();
      if (page === 'add') document.getElementById('addForm').reset();
    }

    async function fetchFlashcards() {
      try {
        const res = await fetch(api);
        if (!res.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∫–∞—Ä—Ç–æ–∫');
        const data = await res.json();
        updateList(Array.isArray(data) ? data : []);
      } catch (e) {
        document.getElementById('flashcards').innerHTML = '<span style="color:red">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–∞—Ä—Ç–∫–∏</span>';
      }
    }

    function updateList(cards) {
      const container = document.getElementById('flashcards');
      container.innerHTML = '';
      if (!Array.isArray(cards) || !cards.length) {
        container.innerHTML = '<em>–ù–µ–º–∞—î –∫–∞—Ä—Ç–æ–∫</em>';
        return;
      }
      cards.forEach(card => {
        const div = document.createElement('div');
        div.className = 'flashcard';
        div.innerHTML = `
          <div class="qa">
            <strong>Q:</strong> <span>${card.question || ''}</span><br>
            <strong>A:</strong> <span>${card.answer || ''}</span>
          </div>
          <div class="flashcard-actions">
            <button onclick="editCard('${card._id}')">‚úèÔ∏è</button>
            <button onclick="deleteCard('${card._id}')">üóëÔ∏è</button>
          </div>
        `;
        container.appendChild(div);
      });
    }

    document.getElementById('addForm').onsubmit = async e => {
      e.preventDefault();
      const question = document.getElementById('question').value.trim();
      const answer = document.getElementById('answer').value.trim();
      if (!question || !answer) return;
      await fetch(api, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question, answer })
      });
      showPage('list');
    };

    window.deleteCard = async id => {
      if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∫–∞—Ä—Ç–∫—É?')) return;
      await fetch(`${api}/${id}`, { method: 'DELETE' });
      showPage('list');
    };

    window.editCard = async id => {
      editingId = id;
      const res = await fetch(`${api}/${id}`);
      const card = await res.json();
      const editDiv = document.getElementById('page-edit');
      editDiv.innerHTML = `
        <h2>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–∞—Ä—Ç–∫—É</h2>
        <form id="editForm">
          <input type="text" id="editQ" value="${card.question || ''}" required />
          <input type="text" id="editA" value="${card.answer || ''}" required />
          <button type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
          <button type="button" onclick="showPage('list')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </form>
      `;
      showPage('edit');
      document.getElementById('editForm').onsubmit = async e => {
        e.preventDefault();
        const question = document.getElementById('editQ').value.trim();
        const answer = document.getElementById('editA').value.trim();
        if (!question || !answer) return;
        await fetch(`${api}/${editingId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question, answer })
        });
        showPage('list');
      };
    };

    // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –ø–æ–∫–∞–∑ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    showPage('list');
  </script>
</body>
</html>
